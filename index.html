<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hyundai Santa Fe – Colour Compare</title>
  <style>
    :root{
      --bg: #f3f4f6;
      --panel: rgba(255,255,255,0.86);
      --text: #111827;
      --muted: #6b7280;
      --border: rgba(17,24,39,0.12);
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
      --radius: 16px;
      --accentA: rgba(59,130,246,0.7);
      --accentB: rgba(16,185,129,0.7);
    }
    [data-theme="dark"]{
      --bg:#0b1020;
      --panel: rgba(17,24,39,0.74);
      --text:#f9fafb;
      --muted:#cbd5e1;
      --border: rgba(255,255,255,0.14);
      --shadow: 0 12px 34px rgba(0,0,0,0.35);
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(255,255,255,0.65), rgba(255,255,255,0.25));
      border-bottom: 1px solid var(--border);
    }
    [data-theme="dark"] header{
      background: linear-gradient(to bottom, rgba(3,7,18,0.70), rgba(3,7,18,0.25));
    }
    .wrap{ max-width: 1500px; margin: 0 auto; padding: 16px; }
    .titleRow{
      display:flex; gap: 14px; align-items: center; justify-content: space-between; flex-wrap: wrap;
    }
    h1{ font-size: 18px; margin: 0; letter-spacing: 0.2px; }
    .controls{ display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .control{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 999px;
      box-shadow: var(--shadow);
    }
    label{ font-size: 12px; color: var(--muted); }
    select{
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      padding: 6px 8px;
      font-size: 12px;
      outline: none;
    }
    button{
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    button:hover{ filter: brightness(0.98); }
    button.primary{
      background: var(--panel);
      box-shadow: var(--shadow);
    }
    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--panel);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      font-size: 12px;
      color: var(--muted);
    }
    .pill b{ color: var(--text); }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }

    main .wrap{ padding-top: 18px; padding-bottom: 28px; }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      align-items: stretch;
    }
    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      min-height: 240px;
      cursor: zoom-in;
      user-select: none;
      transition: transform 180ms ease, outline-color 180ms ease, box-shadow 180ms ease;
      outline: 2px solid transparent;
      outline-offset: 2px;
      position: relative;
    }
    .card:hover{ transform: translateY(-1px); }
    .card.pickA{ outline-color: var(--accentA); box-shadow: 0 12px 36px rgba(59,130,246,0.12); }
    .card.pickB{ outline-color: var(--accentB); box-shadow: 0 12px 36px rgba(16,185,129,0.12); }

    .badge{
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      display:none;
      pointer-events: none;
    }

    .imgWrap{
      position: relative;
      aspect-ratio: 16 / 9;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(0,0,0,0.08));
    }
    [data-theme="dark"] .imgWrap{
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.30));
    }
    img{ width: 100%; height: 100%; object-fit: contain; transform: translateZ(0); }
    .meta{ padding: 12px 12px 14px; display:flex; flex-direction: column; gap: 6px; }
    .name{ font-weight: 650; font-size: 14px; line-height: 1.2; }
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Overlay base */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .overlay.open{ display:flex; }

    .overlayCard{
      width: min(1300px, 98vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.45);
      overflow:hidden;
      position: relative;
    }
    .overlayImgWrap{
      aspect-ratio: 16 / 9;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(0,0,0,0.08));
    }
    [data-theme="dark"] .overlayImgWrap{
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.30));
    }
    .overlayMeta{
      padding: 14px 16px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
      flex-wrap: wrap;
      border-top: 1px solid var(--border);
    }
    .overlayTitle{ font-weight: 750; font-size: 14px; }
    .overlayHint{ color: var(--muted); font-size: 12px; }

    .navBtn, .closeBtn{
      position: absolute;
      border-radius: 999px;
      padding: 10px 12px;
      background: rgba(0,0,0,0.45);
      color: white;
      border: 1px solid rgba(255,255,255,0.25);
      cursor: pointer;
      user-select:none;
    }
    .navBtn:hover, .closeBtn:hover{ background: rgba(0,0,0,0.55); }
    .navBtn{
      top: 50%;
      transform: translateY(-50%);
    }
    .navLeft{ left: 10px; }
    .navRight{ right: 10px; }
    .closeBtn{ top: 10px; right: 10px; padding: 8px 10px; }

    /* Compare overlay */
    .compareCard{
      width: min(1500px, 98vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.45);
      overflow:hidden;
      position: relative;
    }
    .compareTopbar{
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 12px 12px;
      border-bottom: 1px solid var(--border);
    }
    .compareTopbar .left{
      display:flex; gap: 10px; align-items: center; flex-wrap: wrap;
      font-size: 12px; color: var(--muted);
    }
    .compareTopbar .left b{ color: var(--text); }
    .compareTopbar .right{ display:flex; gap: 8px; align-items:center; flex-wrap: wrap; }

    .compareGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }
    @media (max-width: 900px){
      .compareGrid{ grid-template-columns: 1fr; }
    }
    .pane{
      position: relative;
      border-right: 1px solid var(--border);
    }
    @media (max-width: 900px){
      .pane{ border-right: none; border-bottom: 1px solid var(--border); }
    }
    .pane:last-child{ border-right: none; border-bottom: none; }

    .paneHeader{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    .paneHeader .tag{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      font-weight: 750;
      font-size: 12px;
    }
    .dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: var(--accentA);
      display:inline-block;
    }
    .dot.b{ background: var(--accentB); }

    .paneHeader .name{
      font-weight: 700;
      font-size: 12px;
      margin: 0;
      color: var(--text);
    }
    .paneHeader .sub{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 70ch;
    }

    .paneImgWrap{
      aspect-ratio: 16/9;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .paneNav{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display:flex;
      flex-direction: column;
      gap: 8px;
      padding: 8px;
    }
    .paneNav.left{ left: 6px; }
    .paneNav.right{ right: 6px; }
    .paneNav button{
      background: rgba(0,0,0,0.45);
      color: white;
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: none;
    }
    .paneNav button:hover{ background: rgba(0,0,0,0.55); }

  </style>
</head>

<body data-theme="light">
  <header>
    <div class="wrap">
      <div class="titleRow">
        <h1>Hyundai Santa Fe — colour compare (UK labels)</h1>
        <div class="controls">
          <div class="control">
            <label for="frame">Rotation frame</label>
            <select id="frame">
              <option value="001">001</option>
              <option value="002" selected>002</option>
              <option value="003">003</option>
              <option value="004">004</option>
              <option value="005">005</option>
              <option value="006">006</option>
              <option value="007">007</option>
              <option value="008">008</option>
            </select>
          </div>
          <div class="control">
            <label for="size">Image width</label>
            <select id="size">
              <option value="1200">1200</option>
              <option value="1600" selected>1600</option>
              <option value="2000">2000</option>
            </select>
          </div>
          <button id="compareBtn" class="primary" type="button">2-up compare</button>
          <button id="toggleTheme" type="button">Toggle background</button>
        </div>
      </div>

      <div class="hint">
        <span class="pill">Zoom: click a tile • <span class="kbd">←</span>/<span class="kbd">→</span> • <span class="kbd">Esc</span></span>
        <span class="pill">2-up: click <b>2-up compare</b>, then pick colour <b>A</b> and <b>B</b></span>
        <span class="pill" id="pickPill" style="display:none;"><b>Picking…</b> <span id="pickText">Select A</span></span>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="grid" class="grid"></div>
    </div>
  </main>

  <!-- Single zoom overlay -->
  <div id="zoomOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="Zoomed colour">
    <div class="overlayCard">
      <button class="closeBtn" id="zoomClose" title="Close (Esc)">✕</button>
      <button class="navBtn navLeft" id="zoomPrev" title="Previous (←)">←</button>
      <button class="navBtn navRight" id="zoomNext" title="Next (→)">→</button>
      <div class="overlayImgWrap">
        <img id="zoomImg" alt="" />
      </div>
      <div class="overlayMeta">
        <div class="overlayTitle" id="zoomTitle"></div>
        <div class="overlayHint" id="zoomHint"></div>
      </div>
    </div>
  </div>

  <!-- 2-up compare overlay -->
  <div id="compareOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="Two-up comparison">
    <div class="compareCard">
      <button class="closeBtn" id="compareClose" title="Close (Esc)">✕</button>

      <div class="compareTopbar">
        <div class="left">
          <span><b>2-up compare</b></span>
          <span id="compareMeta">Frame 002 • 1600px</span>
          <span class="kbd">A: Q/W • B: O/P</span>
        </div>
        <div class="right">
          <button id="swapBtn" type="button">Swap</button>
          <button id="repickBtn" type="button">Pick different colours</button>
        </div>
      </div>

      <div class="compareGrid">
        <div class="pane">
          <div class="paneHeader">
            <div class="tag"><span class="dot"></span> A</div>
            <div style="text-align:right;">
              <div class="name" id="nameA">—</div>
              <div class="sub" id="subA">←/→ controls: Q/W</div>
            </div>
          </div>
          <div class="paneImgWrap overlayImgWrap">
            <img id="imgA" alt="Compare A" />
          </div>
          <div class="paneNav left">
            <button id="prevA" title="A previous (Q)">Q</button>
          </div>
          <div class="paneNav right">
            <button id="nextA" title="A next (W)">W</button>
          </div>
        </div>

        <div class="pane">
          <div class="paneHeader">
            <div class="tag"><span class="dot b"></span> B</div>
            <div style="text-align:right;">
              <div class="name" id="nameB">—</div>
              <div class="sub" id="subB">←/→ controls: O/P</div>
            </div>
          </div>
          <div class="paneImgWrap overlayImgWrap">
            <img id="imgB" alt="Compare B" />
          </div>
          <div class="paneNav left">
            <button id="prevB" title="B previous (O)">O</button>
          </div>
          <div class="paneNav right">
            <button id="nextB" title="B next (P)">P</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Fixed bit you said stays constant:
  const modelId = "52910NI000";

  // UK display names + DEFINITELY CORRECT asset tokens you provided
  // token format you gave: CODE_Asset_Name_With_Underscores (and sometimes suffixes like -17 / -15)
  const colours = [
    { displayName: "Cyber Sage Pearl",      token: "RS2_Cyber_Sage_Pearl" },
    { displayName: "Creamy White Matte",    token: "WWM_Creamy_White_Matte" },
    { displayName: "Abyss Black Pearl",     token: "A2B_AbyssBlack_Black_Pearl-17" },
    { displayName: "Ocado Green Pearl",     token: "RN2_Ocado_Green_Pearl" },
    { displayName: "Terracotta Orange",     token: "ZGE_Terracotta_Orange_Solid" },
    { displayName: "Earthy Brass",          token: "YBM_Earthy_Brass_Matte" },
    { displayName: "Pebble Blue Pearl",     token: "PB2_Pebble_Blue_Pearl" },
    { displayName: "Ecotronic Grey Pearl",  token: "PE2_Ecotronic_Gray_Pearl-15" },
    { displayName: "Typhoon Silver",        token: "T2X_Typhoon_Silver_Metallic" },
  ];

  const els = {
    grid: document.getElementById("grid"),
    frame: document.getElementById("frame"),
    size: document.getElementById("size"),
    toggleTheme: document.getElementById("toggleTheme"),

    pickPill: document.getElementById("pickPill"),
    pickText: document.getElementById("pickText"),
    compareBtn: document.getElementById("compareBtn"),

    // zoom
    zoomOverlay: document.getElementById("zoomOverlay"),
    zoomImg: document.getElementById("zoomImg"),
    zoomTitle: document.getElementById("zoomTitle"),
    zoomHint: document.getElementById("zoomHint"),
    zoomPrev: document.getElementById("zoomPrev"),
    zoomNext: document.getElementById("zoomNext"),
    zoomClose: document.getElementById("zoomClose"),

    // compare
    compareOverlay: document.getElementById("compareOverlay"),
    compareClose: document.getElementById("compareClose"),
    compareMeta: document.getElementById("compareMeta"),
    swapBtn: document.getElementById("swapBtn"),
    repickBtn: document.getElementById("repickBtn"),
    nameA: document.getElementById("nameA"),
    nameB: document.getElementById("nameB"),
    imgA: document.getElementById("imgA"),
    imgB: document.getElementById("imgB"),
    prevA: document.getElementById("prevA"),
    nextA: document.getElementById("nextA"),
    prevB: document.getElementById("prevB"),
    nextB: document.getElementById("nextB"),
  };

  // state
  let zoomIndex = -1;

  let pickMode = false;   // user is selecting A then B
  let pickStep = 0;       // 0 => selecting A, 1 => selecting B
  let compareA = null;    // index
  let compareB = null;    // index

  function tokenToCodeAndAsset(token){
    // Split on first underscore only: CODE_rest
    const firstUnd = token.indexOf("_");
    const code = token.slice(0, firstUnd);
    const rest = token.slice(firstUnd + 1);     // e.g. "Typhoon_Silver_Metallic"
    // Convert underscores to spaces; keep hyphen suffixes like "-17"
    // Hyundai URLs shown earlier use + for spaces, so we output as "Typhoon+Silver+Metallic"
    const assetWithSpaces = rest.replace(/_/g, " ");
    return { code, assetWithSpaces };
  }

  function encodePlus(str){
    return encodeURIComponent(str).replace(/%20/g, "+");
  }

  function buildUrl(col, frame, wid){
    const { code, assetWithSpaces } = tokenToCodeAndAsset(col.token);
    const colourPart = `${code}-${encodePlus(assetWithSpaces)}`;
    const hei = Math.round(Number(wid) * 0.5625);
    return `https://dmassets.hyundai.com/is/image/hyundaiautoever/HME_MX5_360_EXT_${colourPart}_${modelId}_${frame}?wid=${wid}&hei=${hei}&fmt=png-alpha&fit=wrap,1`;
  }

  function makeCard(col, idx){
    const card = document.createElement("div");
    card.className = "card";
    card.tabIndex = 0;
    card.setAttribute("role", "button");

    const badge = document.createElement("div");
    badge.className = "badge";
    card.appendChild(badge);

    const imgWrap = document.createElement("div");
    imgWrap.className = "imgWrap";

    const img = document.createElement("img");
    img.alt = `Hyundai Santa Fe – ${col.displayName}`;

    const meta = document.createElement("div");
    meta.className = "meta";

    const name = document.createElement("div");
    name.className = "name";
    name.textContent = col.displayName;

    const code = document.createElement("div");
    code.className = "code";
    code.textContent = col.token;

    imgWrap.appendChild(img);
    meta.appendChild(name);
    meta.appendChild(code);

    card.appendChild(imgWrap);
    card.appendChild(meta);

    col._img = img;
    col._card = card;
    col._badge = badge;

    const activate = () => {
      if (pickMode) handlePick(idx);
      else openZoom(idx);
    };

    card.addEventListener("click", activate);
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); activate(); }
    });

    return card;
  }

  function render(){
    els.grid.innerHTML = "";
    const frag = document.createDocumentFragment();
    colours.forEach((c, idx) => frag.appendChild(makeCard(c, idx)));
    els.grid.appendChild(frag);
    updateAllImages();
    refreshPickUI();
  }

  function updateAllImages(){
    const frame = els.frame.value;
    const wid = els.size.value;

    colours.forEach(c => {
      c._img.src = buildUrl(c, frame, wid);
    });

    if (els.zoomOverlay.classList.contains("open") && zoomIndex >= 0){
      const c = colours[zoomIndex];
      els.zoomImg.src = buildUrl(c, frame, wid);
      els.zoomTitle.textContent = c.displayName;
      els.zoomHint.textContent = `Frame ${frame} • ${wid}px • ←/→ • Esc`;
    }

    if (els.compareOverlay.classList.contains("open") && compareA !== null && compareB !== null){
      openCompareOverlay(compareA, compareB, true);
    }
  }

  // ---- Zoom overlay with navigation ----
  function openZoom(index){
    zoomIndex = index;
    const c = colours[zoomIndex];
    const frame = els.frame.value;
    const wid = els.size.value;

    els.zoomTitle.textContent = c.displayName;
    els.zoomHint.textContent = `Frame ${frame} • ${wid}px • ←/→ • Esc`;
    els.zoomImg.alt = `Hyundai Santa Fe – ${c.displayName} (zoomed)`;
    els.zoomImg.src = buildUrl(c, frame, wid);

    els.zoomOverlay.classList.add("open");
  }

  function closeZoom(){
    els.zoomOverlay.classList.remove("open");
    zoomIndex = -1;
    els.zoomImg.src = "";
  }

  function navZoom(dir){
    if (zoomIndex < 0) return;
    zoomIndex = (zoomIndex + dir + colours.length) % colours.length;
    openZoom(zoomIndex);
  }

  els.zoomPrev.addEventListener("click", (e) => { e.stopPropagation(); navZoom(-1); });
  els.zoomNext.addEventListener("click", (e) => { e.stopPropagation(); navZoom(+1); });
  els.zoomClose.addEventListener("click", (e) => { e.stopPropagation(); closeZoom(); });
  els.zoomOverlay.addEventListener("click", (e) => {
    if (e.target === els.zoomOverlay) closeZoom();
  });

  // ---- 2-up compare: pick flow -> overlay ----
  function startPick(){
    pickMode = true;
    pickStep = 0;
    compareA = null;
    compareB = null;
    refreshPickUI();
  }

  function cancelPick(){
    pickMode = false;
    pickStep = 0;
    compareA = null;
    compareB = null;
    refreshPickUI();
  }

  function handlePick(idx){
    if (pickStep === 0){
      compareA = idx;
      pickStep = 1;
    } else {
      compareB = idx;
      // If user picked same twice, treat as "try again"
      if (compareB === compareA) {
        compareB = null;
        return;
      }
      pickMode = false;
      pickStep = 0;
      refreshPickUI();
      openCompareOverlay(compareA, compareB, false);
    }
    refreshPickUI();
  }

  function refreshPickUI(){
    els.pickPill.style.display = pickMode ? "inline-flex" : "none";
    els.pickText.textContent = pickMode ? (pickStep === 0 ? "Select A" : "Select B") : "";

    colours.forEach((c, idx) => {
      c._card.classList.remove("pickA","pickB");
      c._badge.style.display = "none";

      if (!pickMode) return;

      if (pickStep === 0){
        // nothing chosen yet
      } else {
        // A chosen, guide B
        if (compareA === idx){
          c._card.classList.add("pickA");
          c._badge.style.display = "inline-block";
          c._badge.textContent = "A";
          c._badge.style.background = "var(--accentA)";
        } else {
          c._card.classList.add("pickB");
          c._badge.style.display = "inline-block";
          c._badge.textContent = "B";
          c._badge.style.background = "var(--accentB)";
          c._badge.style.opacity = "0.0"; // hide on non-selected; keeps layout stable
        }
      }
    });
  }

  function openCompareOverlay(aIdx, bIdx, keepOpen){
    const frame = els.frame.value;
    const wid = els.size.value;

    const a = colours[aIdx];
    const b = colours[bIdx];

    els.compareMeta.textContent = `Frame ${frame} • ${wid}px`;

    els.nameA.textContent = a.displayName;
    els.nameB.textContent = b.displayName;

    els.imgA.alt = `Compare A – ${a.displayName}`;
    els.imgB.alt = `Compare B – ${b.displayName}`;

    els.imgA.src = buildUrl(a, frame, wid);
    els.imgB.src = buildUrl(b, frame, wid);

    // show overlay if not already
    if (!keepOpen) els.compareOverlay.classList.add("open");
  }

  function closeCompareOverlay(){
    els.compareOverlay.classList.remove("open");
  }

  function swapCompare(){
    const t = compareA; compareA = compareB; compareB = t;
    openCompareOverlay(compareA, compareB, true);
  }

  function stepA(dir){
    compareA = (compareA + dir + colours.length) % colours.length;
    if (compareA === compareB) compareA = (compareA + dir + colours.length) % colours.length;
    openCompareOverlay(compareA, compareB, true);
  }
  function stepB(dir){
    compareB = (compareB + dir + colours.length) % colours.length;
    if (compareB === compareA) compareB = (compareB + dir + colours.length) % colours.length;
    openCompareOverlay(compareA, compareB, true);
  }

  // Buttons
  els.compareBtn.addEventListener("click", () => {
    // if already picking, toggle off
    if (pickMode) cancelPick();
    else startPick();
  });

  els.swapBtn.addEventListener("click", () => swapCompare());
  els.repickBtn.addEventListener("click", () => {
    closeCompareOverlay();
    startPick();
  });
  els.compareClose.addEventListener("click", () => closeCompareOverlay());

  els.prevA.addEventListener("click", (e) => { e.stopPropagation(); stepA(-1); });
  els.nextA.addEventListener("click", (e) => { e.stopPropagation(); stepA(+1); });
  els.prevB.addEventListener("click", (e) => { e.stopPropagation(); stepB(-1); });
  els.nextB.addEventListener("click", (e) => { e.stopPropagation(); stepB(+1); });

  els.compareOverlay.addEventListener("click", (e) => {
    if (e.target === els.compareOverlay) closeCompareOverlay();
  });

  // ---- Controls ----
  els.frame.addEventListener("change", updateAllImages);
  els.size.addEventListener("change", updateAllImages);

  els.toggleTheme.addEventListener("click", () => {
    const body = document.body;
    body.dataset.theme = body.dataset.theme === "dark" ? "light" : "dark";
  });

  // Keyboard shortcuts
  document.addEventListener("keydown", (e) => {
    // While picking: Esc cancels pick
    if (pickMode && e.key === "Escape"){
      cancelPick();
      return;
    }

    // Zoom overlay nav
    if (els.zoomOverlay.classList.contains("open")){
      if (e.key === "Escape") closeZoom();
      if (e.key === "ArrowLeft") navZoom(-1);
      if (e.key === "ArrowRight") navZoom(+1);
      return;
    }

    // Compare overlay controls
    if (els.compareOverlay.classList.contains("open")){
      if (e.key === "Escape") closeCompareOverlay();

      // A: Q/W, B: O/P
      if (e.key.toLowerCase() === "q") stepA(-1);
      if (e.key.toLowerCase() === "w") stepA(+1);
      if (e.key.toLowerCase() === "o") stepB(-1);
      if (e.key.toLowerCase() === "p") stepB(+1);

      // Swap: S
      if (e.key.toLowerCase() === "s") swapCompare();

      return;
    }
  });

  render();
</script>
</body>
</html>
