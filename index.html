<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hyundai Santa Fe – Colour Compare</title>
  <style>
    :root{
      --bg: #f3f4f6;
      --panel: rgba(255,255,255,0.86);
      --text: #111827;
      --muted: #6b7280;
      --border: rgba(17,24,39,0.12);
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
      --radius: 16px;
      --accent: rgba(59,130,246,0.16);
    }
    [data-theme="dark"]{
      --bg:#0b1020;
      --panel: rgba(17,24,39,0.74);
      --text:#f9fafb;
      --muted:#cbd5e1;
      --border: rgba(255,255,255,0.14);
      --shadow: 0 12px 34px rgba(0,0,0,0.35);
      --accent: rgba(59,130,246,0.22);
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(255,255,255,0.65), rgba(255,255,255,0.25));
      border-bottom: 1px solid var(--border);
    }
    [data-theme="dark"] header{
      background: linear-gradient(to bottom, rgba(3,7,18,0.70), rgba(3,7,18,0.25));
    }
    .wrap{ max-width: 1500px; margin: 0 auto; padding: 16px; }
    .titleRow{
      display:flex; gap: 14px; align-items: center; justify-content: space-between; flex-wrap: wrap;
    }
    h1{ font-size: 18px; margin: 0; letter-spacing: 0.2px; }
    .controls{ display:flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .control{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 999px;
      box-shadow: var(--shadow);
    }
    label{ font-size: 12px; color: var(--muted); }
    select{
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      padding: 6px 8px;
      font-size: 12px;
      outline: none;
    }
    button{
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: var(--shadow);
    }
    button:hover{ filter: brightness(0.98); }
    button.ghost{
      background: transparent;
      box-shadow: none;
    }
    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }

    main .wrap{ padding-top: 18px; padding-bottom: 20px; }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      align-items: stretch;
    }
    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      min-height: 240px;
      cursor: zoom-in;
      user-select: none;
      transition: transform 180ms ease, outline-color 180ms ease;
      outline: 2px solid transparent;
      outline-offset: 2px;
      position: relative;
    }
    .card:hover{ transform: translateY(-1px); }
    .card.selectedA{ outline-color: rgba(59,130,246,0.65); }
    .card.selectedB{ outline-color: rgba(16,185,129,0.65); }

    .badge{
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      display:none;
      pointer-events: none;
    }
    .card.selectedA .badge{ display:inline-block; content:"A"; }
    .card.selectedB .badge{ display:inline-block; }
    .card.selectedA .badge{ background: rgba(59,130,246,0.75); }
    .cardzif{}
    .card.selectedB .badge{ background: rgba(16,185,129,0.75); }

    .imgWrap{
      position: relative;
      aspect-ratio: 16 / 9;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(0,0,0,0.08));
    }
    [data-theme="dark"] .imgWrap{
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.30));
    }
    img{ width: 100%; height: 100%; object-fit: contain; transform: translateZ(0); }
    .meta{ padding: 12px 12px 14px; display:flex; flex-direction: column; gap: 6px; }
    .name{ font-weight: 650; font-size: 14px; line-height: 1.2; }
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .status{ font-size: 12px; color: var(--muted); margin-top: 2px; min-height: 16px; }
    .bad{ color: #b91c1c; }

    /* Zoom overlay */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      z-index: 50;
    }
    .overlay.open{ display:flex; }
    .overlayCard{
      width: min(1300px, 98vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.45);
      overflow:hidden;
      position: relative;
    }
    .overlayImgWrap{
      aspect-ratio: 16 / 9;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.10), rgba(0,0,0,0.08));
    }
    [data-theme="dark"] .overlayImgWrap{
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.30));
    }
    .overlayMeta{
      padding: 14px 16px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
      flex-wrap: wrap;
      border-top: 1px solid var(--border);
    }
    .overlayTitle{ font-weight: 750; font-size: 14px; }
    .overlayHint{ color: var(--muted); font-size: 12px; }

    .navBtn{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      border-radius: 999px;
      padding: 10px 12px;
      background: rgba(0,0,0,0.45);
      color: white;
      border: 1px solid rgba(255,255,255,0.25);
      cursor: pointer;
      user-select:none;
    }
    .navBtn:hover{ background: rgba(0,0,0,0.55); }
    .navLeft{ left: 10px; }
    .navRight{ right: 10px; }

    .closeBtn{
      position: absolute;
      top: 10px;
      right: 10px;
      border-radius: 999px;
      padding: 8px 10px;
      background: rgba(0,0,0,0.45);
      color: white;
      border: 1px solid rgba(255,255,255,0.25);
      cursor: pointer;
    }

    /* 2-up compare panel */
    .compareBar{
      position: sticky;
      bottom: 0;
      z-index: 9;
      border-top: 1px solid var(--border);
      background: linear-gradient(to top, rgba(255,255,255,0.72), rgba(255,255,255,0.32));
      backdrop-filter: blur(10px);
    }
    [data-theme="dark"] .compareBar{
      background: linear-gradient(to top, rgba(3,7,18,0.75), rgba(3,7,18,0.25));
    }
    .compareInner{
      max-width: 1500px;
      margin: 0 auto;
      padding: 10px 16px 16px;
      display:none;
      gap: 12px;
      align-items: stretch;
    }
    .compareInner.open{ display:grid; grid-template-columns: 1fr; }
    .compareHeader{
      display:flex; align-items:center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
      padding: 8px 6px 0;
    }
    .compareHeader .left{
      display:flex; gap: 10px; align-items: baseline; flex-wrap: wrap;
    }
    .pill{
      font-size: 12px;
      color: var(--muted);
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      box-shadow: var(--shadow);
    }
    .compareGrid{
      display:grid;
      grid-template-rows: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    .compareTile{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction: column;
    }
    .compareTop{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    .compareLabel{ font-weight: 700; font-size: 13px; }
    .compareSub{ font-size: 12px; color: var(--muted); }
    .compareImgWrap{ aspect-ratio: 16/9; display:flex; align-items:center; justify-content:center; }
  </style>
</head>

<body data-theme="light">
  <header>
    <div class="wrap">
      <div class="titleRow">
        <h1>Hyundai Santa Fe — colour compare (UK labels, correct asset names)</h1>
        <div class="controls">
          <div class="control">
            <label for="frame">Rotation frame</label>
            <select id="frame">
              <option value="001">001</option>
              <option value="002" selected>002</option>
              <option value="003">003</option>
              <option value="004">004</option>
              <option value="005">005</option>
              <option value="006">006</option>
              <option value="007">007</option>
              <option value="008">008</option>
            </select>
          </div>
          <div class="control">
            <label for="size">Image width</label>
            <select id="size">
              <option value="1200">1200</option>
              <option value="1600" selected>1600</option>
              <option value="2000">2000</option>
            </select>
          </div>
          <button id="toggleCompare" type="button" class="ghost">2-up compare: Off</button>
          <button id="toggleTheme" type="button" class="ghost">Toggle background</button>
        </div>
      </div>
      <div class="hint">
        Click a tile to zoom. In zoom: <span class="kbd">←</span>/<span class="kbd">→</span> to navigate, <span class="kbd">Esc</span> to close.
        <br>
        2-up compare mode: turn it on, then click one colour for <b>A</b> and another for <b>B</b> (shown top/bottom).
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="grid" class="grid"></div>
    </div>
  </main>

  <!-- Zoom overlay -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-label="Zoomed colour">
    <div class="overlayCard" id="overlayCard">
      <button class="closeBtn" id="closeBtn" title="Close (Esc)">✕</button>
      <button class="navBtn navLeft" id="prevBtn" title="Previous (←)">←</button>
      <button class="navBtn navRight" id="nextBtn" title="Next (→)">→</button>

      <div class="overlayImgWrap">
        <img id="overlayImg" alt="" />
      </div>
      <div class="overlayMeta">
        <div class="overlayTitle" id="overlayTitle"></div>
        <div class="overlayHint" id="overlayHint"></div>
      </div>
    </div>
  </div>

  <!-- 2-up compare panel -->
  <div class="compareBar">
    <div class="compareInner" id="compareInner">
      <div class="compareHeader">
        <div class="left">
          <span class="pill"><b>2-up compare</b> (same frame)</span>
          <span class="pill" id="compareSummary">Pick A and B</span>
        </div>
        <div class="right">
          <button id="swapAB" class="ghost" type="button">Swap A/B</button>
          <button id="clearAB" class="ghost" type="button">Clear</button>
        </div>
      </div>

      <div class="compareGrid">
        <div class="compareTile">
          <div class="compareTop">
            <div>
              <div class="compareLabel">A</div>
              <div class="compareSub" id="labelA">Not selected</div>
            </div>
          </div>
          <div class="compareImgWrap">
            <img id="imgA" alt="Compare A" />
          </div>
        </div>

        <div class="compareTile">
          <div class="compareTop">
            <div>
              <div class="compareLabel">B</div>
              <div class="compareSub" id="labelB">Not selected</div>
            </div>
          </div>
          <div class="compareImgWrap">
            <img id="imgB" alt="Compare B" />
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // Fixed bit you said stays constant:
  const modelId = "52910NI000";

  // For each colour:
  // - displayName: UK label shown on the page
  // - codeCandidates + assetNameCandidates: tried in order until one loads
  //
  // IMPORTANT: You told me Ecotronic Grey Pearl should map to:
  //   HME_MX5_360_EXT_M2F-Magnetic+Gray_... ✅
  //
  // For the ones you reported failing (Typhoon Silver / Earthy Brass / Terracotta Orange),
  // we now try common Hyundai variants (Metallic/Matte/Solid/etc.) automatically.
  const colours = [
    {
      displayName: "Cyber Sage Pearl",
      codeCandidates: ["RS2"],
      assetNameCandidates: ["Cyber Sage Pearl"]
    },
    {
      displayName: "Creamy White Matte",
      codeCandidates: ["WWM"],
      assetNameCandidates: ["Creamy White Matte"]
    },
    {
      displayName: "Abyss Black Pearl",
      codeCandidates: ["A2B"],
      assetNameCandidates: ["Abyss Black Pearl"]
    },
    {
      displayName: "Ocado Green Pearl",
      codeCandidates: ["RN2"],
      assetNameCandidates: ["Ocado Green Pearl", "Olive Green Pearl"]
    },
    {
      displayName: "Typhoon Silver", // UK label
      codeCandidates: ["T2X"],
      assetNameCandidates: [
        "Typhoon Silver Metallic",
        "Typhoon Silver",
        "Typhoon Silver Pearl",
        "Typhoon Silver Matte"
      ]
    },
    {
      displayName: "Ecotronic Grey Pearl", // UK label
      codeCandidates: ["M2F"],
      assetNameCandidates: ["Magnetic Gray"]
    },
    {
      displayName: "Earthy Brass", // UK label
      codeCandidates: ["YBM"],
      assetNameCandidates: [
        "Earthy Brass Metallic Matte",
        "Earthy Brass Metallic Matt",
        "Earthy Brass Matte",
        "Earthy Brass Matt",
        "Earthy Brass Metallic",
        "Earthy Brass"
      ]
    },
    {
      displayName: "Terracotta Orange", // UK label
      codeCandidates: ["ZGE"],
      assetNameCandidates: [
        "Terracotta Orange Solid",
        "Terracotta Orange",
        "Terra-cotta Orange",
        "Terracotta Orange Metallic"
      ]
    },
    {
      displayName: "Pebble Blue Pearl",
      codeCandidates: ["PB2"],
      assetNameCandidates: ["Pebble Blue Pearl"]
    },
  ];

  const els = {
    grid: document.getElementById("grid"),
    frame: document.getElementById("frame"),
    size: document.getElementById("size"),
    toggleTheme: document.getElementById("toggleTheme"),

    overlay: document.getElementById("overlay"),
    overlayCard: document.getElementById("overlayCard"),
    overlayImg: document.getElementById("overlayImg"),
    overlayTitle: document.getElementById("overlayTitle"),
    overlayHint: document.getElementById("overlayHint"),
    prevBtn: document.getElementById("prevBtn"),
    nextBtn: document.getElementById("nextBtn"),
    closeBtn: document.getElementById("closeBtn"),

    toggleCompare: document.getElementById("toggleCompare"),
    compareInner: document.getElementById("compareInner"),
    compareSummary: document.getElementById("compareSummary"),
    labelA: document.getElementById("labelA"),
    labelB: document.getElementById("labelB"),
    imgA: document.getElementById("imgA"),
    imgB: document.getElementById("imgB"),
    swapAB: document.getElementById("swapAB"),
    clearAB: document.getElementById("clearAB"),
  };

  // state
  let zoomIndex = -1;
  let compareMode = false;
  let compareA = null; // index
  let compareB = null; // index

  function encodePlus(str){
    return encodeURIComponent(str).replace(/%20/g, "+");
  }

  function buildUrl(code, assetName, frame, wid){
    const colourPart = `${code}-${encodePlus(assetName)}`;
    const hei = Math.round(Number(wid) * 0.5625);
    return `https://dmassets.hyundai.com/is/image/hyundaiautoever/HME_MX5_360_EXT_${colourPart}_${modelId}_${frame}?wid=${wid}&hei=${hei}&fmt=png-alpha&fit=wrap,1`;
  }

  // Try candidates until one loads; cache the working pair on the colour object.
  function setImgWithFallback(imgEl, statusEl, colourObj){
    const frame = els.frame.value;
    const wid = els.size.value;

    // if we already found a working pair, just use it
    if (colourObj._working){
      const {code, assetName} = colourObj._working;
      imgEl.src = buildUrl(code, assetName, frame, wid);
      if (statusEl) statusEl.textContent = "";
      return;
    }

    // Build candidate list
    const candidates = [];
    for (const code of colourObj.codeCandidates){
      for (const assetName of colourObj.assetNameCandidates){
        candidates.push({code, assetName});
      }
    }

    let i = 0;
    const tryNext = () => {
      if (i >= candidates.length){
        if (statusEl){
          statusEl.textContent = "Not found (tried several asset name variants).";
          statusEl.classList.add("bad");
        }
        return;
      }
      const c = candidates[i++];
      if (statusEl){
        statusEl.textContent = `Loading… (${c.code}-${c.assetName})`;
        statusEl.classList.remove("bad");
      }

      // We attach one-time handlers for this attempt
      const onLoad = () => {
        imgEl.removeEventListener("error", onError);
        colourObj._working = c; // cache
        if (statusEl) statusEl.textContent = "";
        // also update any "code" label if present
        if (colourObj._codeEl){
          colourObj._codeEl.textContent = `${colourObj.displayName}  •  asset: ${c.code}-${c.assetName}  •  frame: ${frame}`;
        }
      };
      const onError = () => {
        imgEl.removeEventListener("load", onLoad);
        tryNext();
      };

      imgEl.addEventListener("load", onLoad, { once: true });
      imgEl.addEventListener("error", onError, { once: true });

      imgEl.src = buildUrl(c.code, c.assetName, frame, wid);
    };

    tryNext();
  }

  function makeCard(colourObj, index){
    const card = document.createElement("div");
    card.className = "card";
    card.tabIndex = 0;
    card.setAttribute("role","button");
    card.setAttribute("aria-label", `Zoom ${colourObj.displayName}`);

    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = "A";
    card.appendChild(badge);

    const imgWrap = document.createElement("div");
    imgWrap.className = "imgWrap";

    const img = document.createElement("img");
    img.alt = `Hyundai Santa Fe – ${colourObj.displayName}`;

    const meta = document.createElement("div");
    meta.className = "meta";

    const name = document.createElement("div");
    name.className = "name";
    name.textContent = colourObj.displayName;

    const code = document.createElement("div");
    code.className = "code";
    code.textContent = `${colourObj.displayName}  •  frame: ${els.frame.value}`;

    const status = document.createElement("div");
    status.className = "status";
    status.textContent = "Loading…";

    colourObj._img = img;
    colourObj._statusEl = status;
    colourObj._codeEl = code;
    colourObj._cardEl = card;
    colourObj._badgeEl = badge;

    imgWrap.appendChild(img);
    meta.appendChild(name);
    meta.appendChild(code);
    meta.appendChild(status);

    card.appendChild(imgWrap);
    card.appendChild(meta);

    const onActivate = () => {
      if (compareMode){
        handleComparePick(index);
      } else {
        openZoom(index);
      }
    };

    card.addEventListener("click", onActivate);
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onActivate(); }
    });

    return card;
  }

  function render(){
    els.grid.innerHTML = "";
    const frag = document.createDocumentFragment();
    colours.forEach((c, idx) => frag.appendChild(makeCard(c, idx)));
    els.grid.appendChild(frag);
    updateAll();
    refreshCompareUI();
  }

  function updateAll(){
    colours.forEach(c => setImgWithFallback(c._img, c._statusEl, c));

    // keep zoom image in sync if open
    if (els.overlay.classList.contains("open") && zoomIndex >= 0){
      const c = colours[zoomIndex];
      setImgWithFallback(els.overlayImg, null, c);
      const frame = els.frame.value;
      els.overlayHint.textContent = `Frame ${frame} • ${els.size.value}px • ←/→ to navigate • Esc to close`;
      els.overlayTitle.textContent = c.displayName;
    }

    // keep compare in sync
    refreshCompareUI(true);
  }

  // ---- Zoom overlay with navigation ----
  function openZoom(index){
    zoomIndex = index;
    const c = colours[zoomIndex];
    els.overlayTitle.textContent = c.displayName;
    els.overlayHint.textContent = `Frame ${els.frame.value} • ${els.size.value}px • ←/→ to navigate • Esc to close`;
    setImgWithFallback(els.overlayImg, null, c);

    els.overlay.classList.add("open");
  }

  function closeZoom(){
    els.overlay.classList.remove("open");
    zoomIndex = -1;
    els.overlayImg.src = "";
  }

  function navZoom(dir){
    if (zoomIndex < 0) return;
    zoomIndex = (zoomIndex + dir + colours.length) % colours.length;
    openZoom(zoomIndex);
  }

  els.prevBtn.addEventListener("click", (e) => { e.stopPropagation(); navZoom(-1); });
  els.nextBtn.addEventListener("click", (e) => { e.stopPropagation(); navZoom(+1); });
  els.closeBtn.addEventListener("click", (e) => { e.stopPropagation(); closeZoom(); });

  // click backdrop to close (but allow clicking buttons)
  els.overlay.addEventListener("click", (e) => {
    if (e.target === els.overlay) closeZoom();
  });

  document.addEventListener("keydown", (e) => {
    if (els.overlay.classList.contains("open")){
      if (e.key === "Escape") closeZoom();
      if (e.key === "ArrowLeft") navZoom(-1);
      if (e.key === "ArrowRight") navZoom(+1);
    }
  });

  // ---- 2-up compare mode ----
  function setCompareMode(on){
    compareMode = on;
    els.toggleCompare.textContent = `2-up compare: ${compareMode ? "On" : "Off"}`;
    els.compareInner.classList.toggle("open", compareMode);
    if (!compareMode){
      // clear selections highlight when leaving compare mode (keep actual state if you want; I clear for clarity)
      compareA = null;
      compareB = null;
    }
    refreshCompareUI();
  }

  function handleComparePick(index){
    // choose A then B; if both set, replace the older (A) first
    if (compareA === null){
      compareA = index;
    } else if (compareB === null && index !== compareA){
      compareB = index;
    } else if (index === compareA){
      compareA = null;
    } else if (index === compareB){
      compareB = null;
    } else {
      // both set and user picked a third: shift B->A, new->B
      compareA = compareB;
      compareB = index;
    }
    refreshCompareUI();
  }

  function refreshCompareUI(onlyImages=false){
    // update card highlights + badges
    colours.forEach((c, idx) => {
      const card = c._cardEl;
      const badge = c._badgeEl;
      if (!card) return;

      card.classList.toggle("selectedA", compareMode && compareA === idx);
      card.classList.toggle("selectedB", compareMode && compareB === idx);

      if (compareMode && compareA === idx){
        badge.style.display = "inline-block";
        badge.textContent = "A";
        badge.style.background = "rgba(59,130,246,0.78)";
      } else if (compareMode && compareB === idx){
        badge.style.display = "inline-block";
        badge.textContent = "B";
        badge.style.background = "rgba(16,185,129,0.78)";
      } else {
        badge.style.display = "none";
      }
    });

    if (!compareMode){
      els.compareSummary.textContent = "Pick A and B";
      els.labelA.textContent = "Not selected";
      els.labelB.textContent = "Not selected";
      els.imgA.src = "";
      els.imgB.src = "";
      return;
    }

    const frame = els.frame.value;

    if (compareA !== null){
      const cA = colours[compareA];
      els.labelA.textContent = cA.displayName;
      setImgWithFallback(els.imgA, null, cA);
    } else if (!onlyImages){
      els.labelA.textContent = "Not selected";
      els.imgA.src = "";
    }

    if (compareB !== null){
      const cB = colours[compareB];
      els.labelB.textContent = cB.displayName;
      setImgWithFallback(els.imgB, null, cB);
    } else if (!onlyImages){
      els.labelB.textContent = "Not selected";
      els.imgB.src = "";
    }

    const aTxt = compareA !== null ? colours[compareA].displayName : "—";
    const bTxt = compareB !== null ? colours[compareB].displayName : "—";
    els.compareSummary.textContent = `A: ${aTxt}  •  B: ${bTxt}  •  frame ${frame}`;
  }

  els.swapAB.addEventListener("click", () => {
    const t = compareA; compareA = compareB; compareB = t;
    refreshCompareUI();
  });
  els.clearAB.addEventListener("click", () => {
    compareA = null; compareB = null;
    refreshCompareUI();
  });

  // ---- Controls ----
  els.frame.addEventListener("change", () => {
    // changing frame invalidates nothing; just reload with cached working asset pairs
    updateAll();
  });
  els.size.addEventListener("change", updateAll);

  els.toggleTheme.addEventListener("click", () => {
    const body = document.body;
    body.dataset.theme = body.dataset.theme === "dark" ? "light" : "dark";
  });

  els.toggleCompare.addEventListener("click", () => setCompareMode(!compareMode));

  render();
</script>
</body>
</html>
